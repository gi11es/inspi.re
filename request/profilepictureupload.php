<?php/*        Copyright (C) 2008-2009 Gilles Dubuc (www.kouiskas.com - gilles@dubuc.fr)               Updates the profile picture of a user*/require_once(dirname(__FILE__).'/../entities/picture.php');require_once(dirname(__FILE__).'/../entities/user.php');require_once(dirname(__FILE__).'/../utilities/log.php');require_once(dirname(__FILE__).'/../utilities/persistenttoken.php');require_once(dirname(__FILE__).'/../constants.php');$picture_sizes = array();$picture_sizes['status'] = 1;try {	if (isset($_FILES['Filedata']) && isset($_FILES['Filedata']['tmp_name']) && isset($_REQUEST['persistenttoken'])) {		$uid = PersistentToken::get($_REQUEST['persistenttoken']);		$user = User::get($uid);		$picture = new Picture($_FILES['Filedata']['tmp_name']);				if (!$picture->invalid) {				try {				$old_picture = Picture::get($user->getPid());				$old_picture->delete();			} catch (PictureException $e) {}						$user->setPid($picture->getPid());						$picture_sizes['big'] = $picture->getRealThumbnail($PICTURE_SIZE['BIG']);			$picture_sizes['huge'] = $picture->getRealThumbnail($PICTURE_SIZE['HUGE']);			$picture_sizes['status'] = 2;		}			}		echo json_encode($picture_sizes);} catch (PictureException $e) {	Log::error('Picture', 'Couldn\'t get real profile thumbnails '.print_r($e, true));	header("HTTP/1.0 403 Forbidden");}?>