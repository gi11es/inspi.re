<?php/*        Copyright (C) 2008-2009 Gilles Dubuc (www.kouiskas.com - gilles@dubuc.fr)               Updates the picture of a community*/require_once(dirname(__FILE__).'/../entities/community.php');require_once(dirname(__FILE__).'/../entities/picture.php');require_once(dirname(__FILE__).'/../utilities/persistenttoken.php');require_once(dirname(__FILE__).'/../constants.php');$picture_sizes = array();$picture_sizes['status'] = 1;if (isset($_FILES['Filedata']) && isset($_FILES['Filedata']['tmp_name']) && isset($_REQUEST['xid']) && isset($_REQUEST['persistenttoken'])) {	$community = Community::get($_REQUEST['xid']);		$uid = PersistentToken::get($_REQUEST['persistenttoken']);		$picture = new Picture($_FILES['Filedata']['tmp_name']);		if (!$picture->invalid && $uid == $community->getUid()) {					try {			$old_picture = Picture::get($community->getPid());			$old_picture->delete();		} catch (PictureException $e) {}				$community->setPid($picture->getPid());				$picture_sizes = array();		$picture_sizes['big'] = $picture->getRealThumbnail($PICTURE_SIZE['BIG']);		$picture_sizes['huge'] = $picture->getRealThumbnail($PICTURE_SIZE['HUGE']);		$picture_sizes['status'] = 2;	}}echo json_encode($picture_sizes);?>