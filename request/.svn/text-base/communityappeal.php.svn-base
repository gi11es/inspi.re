<?php/*        Copyright (C) 2008-2009 Gilles Dubuc (www.kouiskas.com - gilles@dubuc.fr)               Send an email appeal to an inactive community administrator*/require_once(dirname(__FILE__).'/../entities/community.php');require_once(dirname(__FILE__).'/../entities/user.php');require_once(dirname(__FILE__).'/../utilities/email.php');require_once(dirname(__FILE__).'/../utilities/persistenttoken.php');require_once(dirname(__FILE__).'/../utilities/string.php');require_once(dirname(__FILE__).'/../constants.php');$user = User::getSessionUser();if (isset($_REQUEST['xid']) && isset($_REQUEST['message'])) try {	$community = Community::get($_REQUEST['xid']);	$administrator = User::get($community->getUid());		$persistenttoken = new PersistentToken($community->getXid().'-'.$user->getUid());		Email::mail($administrator->getEmail(), $administrator->getLid(), 				'COMMUNITY_APPEAL', 				array('username' => $administrator->getUniquename(),					'communityname' => $community->getName(),					'appealname' => $user->getUniquename(),					'appealtext' => stripslashes($_REQUEST['message']),					'href' => $REQUEST['TRANSFER_ADMINISTRATION'].'?persistenttoken='.$persistenttoken->getHash(),					));						header('Location: '.$PAGE['COMMUNITY'].'?lid='.$user->getLid().'&xid='.$community->getXid().'&appeal=true');} catch (Exception $e) {	header('Location: '.$PAGE['COMMUNITIES'].'?lid='.$user->getLid());}?>